<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Diatom Guy Adventure</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      overflow: hidden;
      background: #000;
      width: 100vw;
      height: 100vh;
    }

    #game {
      position: relative;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
    }

    #background {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 0;
    }

    .scene-element {
      position: absolute;
      z-index: 1;
    }

    /* Scene 1 elements */
    #diatom-guy {
      left: 8%;
      bottom: 5%;
      height: 45%;
      z-index: 2;
    }

    #diatom-guy-with-hat {
      left: 8%;
      bottom: 5%;
      height: 45%;
      z-index: 2;
      display: none;
      cursor: grab;
    }

    #diatom-guy-with-hat.dragging {
      cursor: grabbing;
    }

    #hat {
      left: 15%;
      bottom: 48%;
      height: 15%;
      z-index: 3;
      cursor: pointer;
      animation: bob 1.5s ease-in-out infinite;
    }

    #door {
      right: 10%;
      bottom: 5%;
      height: 55%;
      z-index: 1;
      display: none;
      opacity: 0;
      transition: opacity 0.6s ease-in;
    }

    #door.visible {
      opacity: 1;
    }

    .bobbing {
      animation: bob 1.5s ease-in-out infinite;
    }

    @keyframes bob {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-12px); }
    }

    /* Scene 2 elements */
    #house {
      left: 5%;
      bottom: 5%;
      height: 70%;
      z-index: 1;
      display: none;
    }

    #diatom-guy-scene2 {
      left: 18%;
      bottom: 5%;
      height: 40%;
      z-index: 2;
      display: none;
    }

    #car {
      left: 50%;
      bottom: 3%;
      height: 20%;
      z-index: 3;
      display: none;
      cursor: pointer;
      transform: translateX(-50%);
    }

    @keyframes shake {
      0%, 100% { transform: translateX(-50%) translateY(0) rotate(0deg); }
      20% { transform: translateX(-50%) translateY(-2px) rotate(-1deg); }
      40% { transform: translateX(-50%) translateY(1px) rotate(1deg); }
      60% { transform: translateX(-50%) translateY(-1px) rotate(-0.5deg); }
      80% { transform: translateX(-50%) translateY(2px) rotate(0.5deg); }
    }

    #car.shaking {
      animation: shake 0.15s ease-in-out infinite;
    }

    #car.drive-away {
      animation: none;
      transition: transform 1.5s ease-in;
      transform: translateX(120vw);
    }

    /* Scene 2 background */
    #scene2-bg {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(180deg, #87CEEB 0%, #87CEEB 60%, #4a8f3f 60%, #3d7a34 100%);
      z-index: 0;
      display: none;
    }
  </style>
</head>
<body>
  <div id="game">
    <!-- Scene 1 -->
    <img id="background" src="assets/inside-scene2.jpg" alt="Background">
    <img id="diatom-guy" class="scene-element" src="assets/diatom-guy.png" alt="Diatom Guy">
    <img id="diatom-guy-with-hat" class="scene-element" src="assets/diatom-guy-with-hat.png" alt="Diatom Guy with Hat">
    <img id="hat" class="scene-element" src="assets/hat.png" alt="Hat">
    <img id="door" class="scene-element" src="assets/door.png" alt="Door">

    <!-- Scene 2 -->
    <div id="scene2-bg"></div>
    <img id="house" class="scene-element" src="assets/house.png" alt="House">
    <img id="diatom-guy-scene2" class="scene-element" src="assets/diatom-guy-with-hat.png" alt="Diatom Guy with Hat">
    <img id="car" class="scene-element" src="assets/car.png" alt="Car">
  </div>

  <script>
    const game = document.getElementById('game');
    const background = document.getElementById('background');
    const diatomGuy = document.getElementById('diatom-guy');
    const diatomGuyWithHat = document.getElementById('diatom-guy-with-hat');
    const hat = document.getElementById('hat');
    const door = document.getElementById('door');
    const scene2Bg = document.getElementById('scene2-bg');
    const house = document.getElementById('house');
    const diatomGuyScene2 = document.getElementById('diatom-guy-scene2');
    const car = document.getElementById('car');

    let isDragging = false;
    let dragOffsetX = 0;
    let dragOffsetY = 0;

    // Scene 1: Click on hat
    hat.addEventListener('click', () => {
      // Hide diatom-guy, show diatom-guy-with-hat
      diatomGuy.style.display = 'none';
      hat.style.display = 'none';
      diatomGuyWithHat.style.display = 'block';
      diatomGuyWithHat.classList.add('bobbing');

      // Show door with fade-in
      door.style.display = 'block';
      requestAnimationFrame(() => {
        door.classList.add('visible');
      });
    });

    // Drag functionality for diatom-guy-with-hat
    diatomGuyWithHat.addEventListener('mousedown', (e) => {
      isDragging = true;
      diatomGuyWithHat.classList.add('dragging');
      diatomGuyWithHat.classList.remove('bobbing');

      const rect = diatomGuyWithHat.getBoundingClientRect();
      dragOffsetX = e.clientX - rect.left;
      dragOffsetY = e.clientY - rect.top;

      // Switch to absolute positioning from current position
      diatomGuyWithHat.style.left = rect.left + 'px';
      diatomGuyWithHat.style.bottom = 'auto';
      diatomGuyWithHat.style.top = rect.top + 'px';

      e.preventDefault();
    });

    document.addEventListener('mousemove', (e) => {
      if (!isDragging) return;

      diatomGuyWithHat.style.left = (e.clientX - dragOffsetX) + 'px';
      diatomGuyWithHat.style.top = (e.clientY - dragOffsetY) + 'px';
      e.preventDefault();
    });

    document.addEventListener('mouseup', (e) => {
      if (!isDragging) return;
      isDragging = false;
      diatomGuyWithHat.classList.remove('dragging');

      // Check if dropped on door
      const diatomRect = diatomGuyWithHat.getBoundingClientRect();
      const doorRect = door.getBoundingClientRect();

      const diatomCenterX = diatomRect.left + diatomRect.width / 2;
      const diatomCenterY = diatomRect.top + diatomRect.height / 2;

      if (
        diatomCenterX >= doorRect.left &&
        diatomCenterX <= doorRect.right &&
        diatomCenterY >= doorRect.top &&
        diatomCenterY <= doorRect.bottom
      ) {
        startScene2();
      } else {
        // Snap back to original position
        diatomGuyWithHat.style.left = '8%';
        diatomGuyWithHat.style.top = '';
        diatomGuyWithHat.style.bottom = '5%';
        diatomGuyWithHat.classList.add('bobbing');
      }
    });

    // Touch support for drag
    diatomGuyWithHat.addEventListener('touchstart', (e) => {
      const touch = e.touches[0];
      isDragging = true;
      diatomGuyWithHat.classList.add('dragging');
      diatomGuyWithHat.classList.remove('bobbing');

      const rect = diatomGuyWithHat.getBoundingClientRect();
      dragOffsetX = touch.clientX - rect.left;
      dragOffsetY = touch.clientY - rect.top;

      diatomGuyWithHat.style.left = rect.left + 'px';
      diatomGuyWithHat.style.bottom = 'auto';
      diatomGuyWithHat.style.top = rect.top + 'px';

      e.preventDefault();
    });

    document.addEventListener('touchmove', (e) => {
      if (!isDragging) return;
      const touch = e.touches[0];

      diatomGuyWithHat.style.left = (touch.clientX - dragOffsetX) + 'px';
      diatomGuyWithHat.style.top = (touch.clientY - dragOffsetY) + 'px';
      e.preventDefault();
    });

    document.addEventListener('touchend', (e) => {
      if (!isDragging) return;
      isDragging = false;
      diatomGuyWithHat.classList.remove('dragging');

      const diatomRect = diatomGuyWithHat.getBoundingClientRect();
      const doorRect = door.getBoundingClientRect();

      const diatomCenterX = diatomRect.left + diatomRect.width / 2;
      const diatomCenterY = diatomRect.top + diatomRect.height / 2;

      if (
        diatomCenterX >= doorRect.left &&
        diatomCenterX <= doorRect.right &&
        diatomCenterY >= doorRect.top &&
        diatomCenterY <= doorRect.bottom
      ) {
        startScene2();
      } else {
        diatomGuyWithHat.style.left = '8%';
        diatomGuyWithHat.style.top = '';
        diatomGuyWithHat.style.bottom = '5%';
        diatomGuyWithHat.classList.add('bobbing');
      }
    });

    // Scene 2 transition
    function startScene2() {
      // Hide Scene 1 elements
      background.style.display = 'none';
      diatomGuy.style.display = 'none';
      diatomGuyWithHat.style.display = 'none';
      hat.style.display = 'none';
      door.style.display = 'none';

      // Show Scene 2 elements
      scene2Bg.style.display = 'block';
      house.style.display = 'block';
      diatomGuyScene2.style.display = 'block';
      car.style.display = 'block';
    }

    // Scene 2: Click on car
    car.addEventListener('click', () => {
      if (car.src.includes('car-with-driver')) return;

      // Hide diatom guy
      diatomGuyScene2.style.display = 'none';

      // Replace car with car-with-driver
      car.src = 'assets/car-with-driver.png';
      car.style.cursor = 'default';

      // Start shaking
      car.classList.add('shaking');

      // After 1 second, drive away
      setTimeout(() => {
        car.classList.remove('shaking');
        car.classList.add('drive-away');
      }, 1000);
    });
  </script>
</body>
</html>
